---
- name: "Verify Evolinux sudoers file presence (jessie)"
  template:
    src: sudoers_jessie.j2
    dest: /etc/sudoers.d/evolinux
    force: no
    mode: "0440"
    validate: '/usr/sbin/visudo -cf %s'
  register: copy_sudoers_evolinux

- name: "Add user in sudoers file for '{{ item }}' (jessie)"
  replace:
    dest: /etc/sudoers.d/evolinux
    regexp: '^(User_Alias\s+ADMINS\s+=((?!{{ item }}).)*)$'
    replace: '\1,{{ item }}'
    validate: '/usr/sbin/visudo -cf %s'
  when: not copy_sudoers_evolinux.changed
  with_items: "{{ evolinux_users | list }}"
