---

- name: Is ipaddr_whitelist.conf present?
  stat:
    path: /etc/apache2/ipaddr_whitelist.conf
  register: _ipaddr_whitelist_conf

- name: Add IP addresses to private IP whitelist
  lineinfile:
    dest: /etc/apache2/ipaddr_whitelist.conf
    line: "Require ip {{ item }}"
    state: present
  loop: "{{ apache_ipaddr_whitelist_present }}"
  notify: reload apache
  tags:
    - apache
    - ips
  when: _ipaddr_whitelist_conf.stat.exists or not ansible_check_mode

- name: Remove IP addresses from private IP whitelist
  lineinfile:
    dest: /etc/apache2/ipaddr_whitelist.conf
    line: "Require ip {{ item }}"
    state: absent
  loop: "{{ apache_ipaddr_whitelist_absent }}"
  notify: reload apache
  tags:
    - apache
    - ips
