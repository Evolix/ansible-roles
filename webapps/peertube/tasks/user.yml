---
- name: Create {{ peertube_user }} unix group
  group:
    name: "{{ peertube_user | mandatory }}"
    state: present
  tags:
    - peertube

- name: Create {{ peertube_user | mandatory }} unix user
  user:
    name: "{{ peertube_user | mandatory }}"
    group: "{{ peertube_user | mandatory }}"
    home: "{{ peertube_home | mandatory }}"
    shell: '/bin/bash'
    create_home: True
    state: present
    mode: "0755"
  tags:
  - peertube

- name: Create top-level directories
  file:
    dest: "{{ item }}"
    state: directory
    mode: "0700"
    owner: "{{ peertube_user }}"
    group: "{{ peertube_user }}"
  loop:
    - "{{ peertube_home }}/log"
    - "{{ peertube_home }}/tmp"
    - "{{ peertube_home }}/data"
  tags:
    - peertube
