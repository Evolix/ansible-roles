---

- include_role:
    name: evolix/apt
    tasks_from: backports.yml
  tags:
  - haproxy
  - packages

- name: Prefer HAProxy package from backports
  template:
    src: haproxy_apt_preferences.j2
    dest: /etc/apt/preferences.d/999-haproxy
    force: yes
    mode: "0640"
  register: haproxy_apt_preferences
  tags:
  - haproxy
  - packages

- name: update apt
  apt:
    update_cache: yes
  when: haproxy_apt_preferences is changed
  tags:
  - haproxy
  - packages
