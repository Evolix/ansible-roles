---

- include_role:
    name: evolix/remount-usr

- name: dump-server-state script is present
  copy:
    src: "dump-server-state.sh"
    dest: /usr/local/sbin/dump-server-state
    force: True
    owner: root
    group: root
    mode: "0750"

- name: symlink backup-server-state to dump-server-state
  file:
    src: /usr/local/sbin/dump-server-state
    dest: /usr/local/sbin/backup-server-state
    state: link
    force: yes

- name: "/sbin/deny script is present"
  copy:
    src: deny.sh
    dest: /sbin/deny
    mode: "0700"
    owner: root
    group: root
    force: no

- name: update-evobackup-canary script is present
  copy:
    src: "update-evobackup-canary.sh"
    dest: /usr/local/bin/update-evobackup-canary
    force: True
    owner: root
    group: root
    mode: "0755"

# TODO: delete when this has been run once on all our servers
- name: update-evobackup-canary is removed from sbin
  file:
    path: /usr/local/sbin/update-evobackup-canary
    state: absent

- name: dir-check script is present
  copy:
    src: "dir-check.sh"
    dest: /usr/local/bin/dir-check
    force: True
    owner: root
    group: root
    mode: "0755"