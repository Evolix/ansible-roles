---

- ansible.builtin.include_role:
    name: evolix/remount-usr

- ansible.builtin.include_tasks:
    file: dump-server-state.yml

- name: "/sbin/deny script is present"
  ansible.builtin.copy:
    src: deny.sh
    dest: /sbin/deny
    mode: "0700"
    owner: root
    group: root
    force: no

- name: update-evobackup-canary script is present
  ansible.builtin.copy:
    src: update-evobackup-canary
    dest: /usr/local/bin/update-evobackup-canary
    force: True
    owner: root
    group: root
    mode: "0755"

# TODO: delete when this has been run once on all our servers
- name: update-evobackup-canary is removed from sbin
  ansible.builtin.file:
    path: /usr/local/sbin/update-evobackup-canary
    state: absent

- name: Deploy htop configuration
  ansible.builtin.copy:
    src: htoprc
    dest: /etc/htoprc
    mode: "0644"

- name: Deploy top configuration file
  ansible.builtin.file:
    path: /etc/topdefaultrc
    state: absent
