---

- import_role:
    name: evolix/remount-usr

- import_tasks:
    file: dump-server-state.yml

- name: "/sbin/deny script is present"
  copy:
    src: deny.sh
    dest: /sbin/deny
    mode: "0700"
    owner: root
    group: root
    force: no

- name: update-evobackup-canary script is present
  copy:
    src: update-evobackup-canary
    dest: /usr/local/bin/update-evobackup-canary
    force: True
    owner: root
    group: root
    mode: "0755"

# TODO: delete when this has been run once on all our servers
- name: update-evobackup-canary is removed from sbin
  file:
    path: /usr/local/sbin/update-evobackup-canary
    state: absent

# - name: dir-check script is present
#   copy:
#     src: "dir-check.sh"
#     dest: /usr/local/bin/dir-check
#     force: True
#     owner: root
#     group: root
#     mode: "0755"

- name: Deploy htop configuration
  copy:
    src: htoprc
    dest: /etc/htoprc
    mode: "0644"

- name: Deploy top configuration file
  file:
    path: /etc/topdefaultrc
    state: absent
