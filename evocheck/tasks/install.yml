---
- include_role:
    name: evolix/remount-usr
  when: evocheck_bin_dir is search("/usr")
  tags:
    - evocheck

- name: Scripts dir is present
  file:
    path: "{{ evocheck_bin_dir }}"
    state: directory
    owner: root
    group: root
    mode: "0700"
  tags:
    - evocheck

- name: Script for Debian 7 and earlier
  set_fact:
    evocheck_script_src: evocheck.wheezy.sh
  when: ansible_distribution_major_version is version('7', '<=')

- name: Script for Debian 8
  set_fact:
    evocheck_script_src: evocheck.jessie.sh
  when: ansible_distribution_major_version is version('8', '=')

- name: Script for Debian 9 and later
  set_fact:
    evocheck_script_src: evocheck.sh
  when: ansible_distribution_major_version is version('9', '>=')

- name: Copy evocheck.sh
  copy:
    src: "{{ evocheck_script_src }}"
    dest: "{{ evocheck_bin_dir }}/evocheck.sh"
    mode: "0700"
    owner: root
    force: yes
  tags:
    - evocheck

- name: Copy evocheck.cf
  copy:
    src: evocheck.cf
    dest: /etc/evocheck.cf
    force: no
  tags:
    - evocheck
