---

- name: add IP addresses to private IP whitelist
  ansible.builtin.lineinfile:
    dest: /etc/nginx/snippets/ipaddr_whitelist
    line: "allow {{ item }};"
    state: present
  loop: "{{ nginx_ipaddr_whitelist_present }}"
  when: not ansible_check_mode
  notify: reload nginx
  tags:
    - nginx
    - ips

- name: remove IP addresses from private IP whitelist
  ansible.builtin.lineinfile:
    dest: /etc/nginx/snippets/ipaddr_whitelist
    line: "allow {{ item }};"
    state: absent
  loop: "{{ nginx_ipaddr_whitelist_absent }}"
  when: not ansible_check_mode
  notify: reload nginx
  tags:
    - nginx
    - ips
