---

- name: Compose minifirewall_restart_handler_name variable
  set_fact:
    minifirewall_restart_handler_name: "{{ minifirewall_restart_if_needed | bool | ternary('restart minifirewall', 'restart minifirewall (noop)') }}"

- name: Fail if minifirewall_main_file is defined
  fail:
    msg: "Variable minifirewall_main_file is deprecated and not configurable anymore."
  when: minifirewall_main_file is defined

- include: install.yml

- include: config.yml
  when: minifirewall_update_config | bool

- include: nrpe.yml

- include: activate.yml

- include: tail.yml
  when: minifirewall_tail_included | bool

- name: Force restart minifirewall
  command: /etc/init.d/minifirewall restart
  register: minifirewall_init_restart
  failed_when: "'starting IPTables rules is now finish : OK' not in minifirewall_init_restart.stdout"
  when: minifirewall_restart_force | bool