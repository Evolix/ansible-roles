---

- name: Add Evolix GPG key
  ansible.builtin.copy:
    src: pub_evolix.asc
    dest: "{{ apt_keyring_dir }}/pub_evolix.asc"
    force: yes
    mode: "0644"
    owner: root
    group: root

- name: Add Evolix backports repository
  ansible.builtin.apt_repository:
    repo: "deb [signed-by={{ apt_keyring_dir }}/pub_evolix.asc] http://pub.evolix.org/evolix {{ ansible_distribution_release }}-backports main"
    filename: backports.list
    state: present

- name: Update APT cache
  ansible.builtin.apt:
    update_cache: yes

- name: Add APT preference file
  ansible.builtin.template:
    src: patroni.pref.j2
    dest: /etc/apt/preferences.d/patroni.pref
    mode: "0644"

