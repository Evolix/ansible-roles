---
- fail:
    msg: only compatible with Debian >= 9
  when:
  - ansible_distribution != "Debian" or ansible_distribution_major_version | version_compare('9', '<')

- name: Additional packages are installed
  apt:
    name: '{{ item }}'
    state: present
  with_items:
  - libapache2-mod-security2
  - modsecurity-crs
  - apg

- name: Additional modules are enabled
  apache2_module:
    name: '{{ item }}'
    state: present
  with_items:
  - ssl
  - include
  - negotiation
  - alias

- name: Install Evoadmin
  include_role:
    name: webapps/evoadmin-mail
  vars:
    evoadminmail_enable_vhost: '{{ packmail_enable_evoadmin_vhost }}'

- name: Install Roundcube
  include_role:
    name: webapps/roundcube
