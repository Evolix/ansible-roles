---

- fail:
    msg: only compatible with Debian >= 9
  when:
  - ansible_distribution != "Debian" or ansible_distribution_major_version | version_compare('9', '<')

- name: Include ldap role
  include_role:
    name: ldap

- name: upload evolix schema
  copy:
    src: cn4evolix.ldif
    dest: /root/cn4evolix.ldif
    mode: "0640"

- name: inject evolix schema
  command: ldapadd -Y EXTERNAL -H ldapi:/// -f /root/cn4evolix.ldif

- name: Include postfix role
  include_role:
    name: postfix

- name: Include dovecot role
  include_role:
    name: dovecot

- name: Include apache role
  include_role:
    name: apache

- name: Include PHP role
  include_role:
    name: php
  vars:
    php_apache_enable: True

- include: apache.yml

- name: Install Evoadmin
  include_role:
    name: webapps/evoadmin-mail
  vars:
    evoadminmail_enable_vhost: '{{ packmail_enable_evoadmin_vhost }}'

