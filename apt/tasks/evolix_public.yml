---

- name: Look for /etc/apt/trusted.gpg
  stat:
    path: /etc/apt/trusted.gpg
  register: apt_trusted_gpg
  tags:
    - apt

- name: Evolix GPG embedded key is absent
  apt_key:
    id: "B8612B5D"
    state: absent
  when: apt_trusted_gpg.stat.exists
  tags:
    - apt

- name: Add Evolix GPG key
  copy:
    src: reg.asc
    dest: /etc/apt/trusted.gpg.d/reg.asc
    force: yes
    mode: "0644"
  tags:
    - apt

- name: Evolix public list is installed
  template:
    src: evolix_public.list.j2
    dest: /etc/apt/sources.list.d/evolix_public.list
    force: yes
    mode: "0640"
  register: apt_evolix_public
  tags:
    - apt

- name: Apt update
  apt:
    update_cache: yes
  when: apt_evolix_public is changed
  tags:
    - apt
